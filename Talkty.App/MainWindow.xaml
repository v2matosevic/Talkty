<Window x:Class="Talkty.App.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:tb="http://www.hardcodet.net/taskbar"
        xmlns:controls="clr-namespace:Talkty.App.Controls"
        Title="Talkty"
        Height="420"
        Width="380"
        MinHeight="380"
        MinWidth="340"
        WindowStartupLocation="CenterScreen"
        WindowStyle="None"
        AllowsTransparency="True"
        Background="Transparent"
        ResizeMode="CanResizeWithGrip">

    <Border Background="{StaticResource Zinc950Brush}"
            CornerRadius="12"
            BorderBrush="{StaticResource Zinc800Brush}"
            BorderThickness="1">
        <Grid>
            <!-- Tray Icon -->
            <tb:TaskbarIcon x:Name="TrayIcon"
                            IconSource="/Resources/tray.ico"
                            ToolTipText="Talkty"
                            TrayMouseDoubleClick="TrayIcon_TrayMouseDoubleClick"
                            Visibility="Visible">
                <tb:TaskbarIcon.ContextMenu>
                    <ContextMenu>
                        <MenuItem Header="Open" Click="OpenMenuItem_Click"/>
                        <MenuItem Header="Settings" Click="SettingsMenuItem_Click"/>
                        <MenuItem Header="About" Click="AboutMenuItem_Click"/>
                        <Separator/>
                        <MenuItem Header="Exit" Click="ExitMenuItem_Click"/>
                    </ContextMenu>
                </tb:TaskbarIcon.ContextMenu>
            </tb:TaskbarIcon>

            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="40"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <!-- Custom Title Bar -->
                <Grid Grid.Row="0" Background="Transparent" MouseLeftButtonDown="TitleBar_MouseLeftButtonDown">
                    <TextBlock Text="Talkty"
                               Foreground="{StaticResource Zinc400Brush}"
                               FontSize="12"
                               FontWeight="Medium"
                               VerticalAlignment="Center"
                               Margin="16,0,0,0"/>

                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" VerticalAlignment="Center" Margin="0,0,8,0">
                        <!-- Minimize -->
                        <Button Style="{StaticResource IconButton}" Click="MinimizeButton_Click" ToolTip="Minimize">
                            <Path Data="M4,12 L20,12" Stroke="{StaticResource Zinc500Brush}" StrokeThickness="1.5" Width="12" Height="12" Stretch="Uniform"/>
                        </Button>
                        <!-- Close -->
                        <Button Style="{StaticResource IconButton}" Click="CloseButton_Click" ToolTip="Close">
                            <Path Data="M4,4 L20,20 M20,4 L4,20" Stroke="{StaticResource Zinc500Brush}" StrokeThickness="1.5" Width="10" Height="10" Stretch="Uniform"/>
                        </Button>
                    </StackPanel>
                </Grid>

                <!-- Content -->
                <Grid Grid.Row="1" Margin="24,0,24,24">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <!-- Update Available Banner -->
                    <Border Grid.Row="0"
                            CornerRadius="8"
                            Padding="12,8"
                            Margin="0,0,0,12"
                            Visibility="{Binding UpdateAvailable, Converter={StaticResource BooleanToVisibilityConverter}}">
                        <Border.Background>
                            <LinearGradientBrush StartPoint="0,0" EndPoint="1,0">
                                <GradientStop Color="#1a3730" Offset="0"/>
                                <GradientStop Color="#1a2f30" Offset="1"/>
                            </LinearGradientBrush>
                        </Border.Background>
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>

                            <StackPanel Grid.Column="0" Orientation="Horizontal" VerticalAlignment="Center">
                                <TextBlock Text="Update available: v"
                                           FontSize="12"
                                           Foreground="{StaticResource Zinc300Brush}"/>
                                <TextBlock Text="{Binding LatestVersion}"
                                           FontSize="12"
                                           FontWeight="SemiBold"
                                           Foreground="#32D583"/>
                            </StackPanel>

                            <Button Grid.Column="1"
                                    Content="Download"
                                    Style="{StaticResource SmallButton}"
                                    Command="{Binding DownloadUpdateCommand}"
                                    Margin="0,0,8,0"/>

                            <Button Grid.Column="2"
                                    Style="{StaticResource IconButton}"
                                    Command="{Binding DismissUpdateCommand}"
                                    ToolTip="Dismiss"
                                    Width="20" Height="20">
                                <Path Data="M4,4 L12,12 M12,4 L4,12"
                                      Stroke="{StaticResource Zinc500Brush}"
                                      StrokeThickness="1.5"
                                      Width="8" Height="8"
                                      Stretch="Uniform"/>
                            </Button>
                        </Grid>
                    </Border>

                    <!-- Main Recording Button -->
                    <Border Grid.Row="1"
                            CornerRadius="14"
                            Padding="18,20"
                            Cursor="Hand"
                            MouseLeftButtonUp="RecordButton_Click"
                            ToolTip="Click or press the hotkey to start/stop recording">
                        <Border.Style>
                            <Style TargetType="Border">
                                <Setter Property="Background" Value="{StaticResource Zinc900Brush}"/>
                                <Style.Triggers>
                                    <Trigger Property="IsMouseOver" Value="True">
                                        <Setter Property="Background" Value="{StaticResource Zinc800Brush}"/>
                                    </Trigger>
                                    <DataTrigger Binding="{Binding IsListening}" Value="True">
                                        <Setter Property="Background">
                                            <Setter.Value>
                                                <SolidColorBrush Color="#1A2020"/>
                                            </Setter.Value>
                                        </Setter>
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </Border.Style>

                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>

                            <!-- Recording Indicator -->
                            <Grid Grid.Column="0" Width="44" Height="44" Margin="0,0,14,0">
                                <Ellipse Width="44" Height="44" StrokeThickness="2" Opacity="0.25">
                                    <Ellipse.Style>
                                        <Style TargetType="Ellipse">
                                            <Setter Property="Stroke" Value="#32D583"/>
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding IsListening}" Value="True">
                                                    <Setter Property="Stroke" Value="#FF6B6B"/>
                                                </DataTrigger>
                                                <DataTrigger Binding="{Binding IsTranscribing}" Value="True">
                                                    <Setter Property="Stroke" Value="#8B5CF6"/>
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </Ellipse.Style>
                                </Ellipse>
                                <Ellipse Width="18" Height="18" HorizontalAlignment="Center" VerticalAlignment="Center">
                                    <Ellipse.Style>
                                        <Style TargetType="Ellipse">
                                            <Setter Property="Fill" Value="#32D583"/>
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding IsListening}" Value="True">
                                                    <Setter Property="Fill" Value="#FF6B6B"/>
                                                </DataTrigger>
                                                <DataTrigger Binding="{Binding IsTranscribing}" Value="True">
                                                    <Setter Property="Fill" Value="#8B5CF6"/>
                                                </DataTrigger>
                                                <DataTrigger Binding="{Binding IsModelLoading}" Value="True">
                                                    <Setter Property="Fill" Value="#F59E0B"/>
                                                </DataTrigger>
                                                <DataTrigger Binding="{Binding IsModelLoaded}" Value="False">
                                                    <Setter Property="Fill" Value="#EF4444"/>
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </Ellipse.Style>
                                </Ellipse>
                            </Grid>

                            <!-- Status Text -->
                            <StackPanel Grid.Column="1" VerticalAlignment="Center">
                                <TextBlock FontSize="14" FontWeight="SemiBold" Foreground="{StaticResource Zinc100Brush}">
                                    <TextBlock.Style>
                                        <Style TargetType="TextBlock">
                                            <Setter Property="Text" Value="Ready to Record"/>
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding IsListening}" Value="True">
                                                    <Setter Property="Text" Value="Recording..."/>
                                                </DataTrigger>
                                                <DataTrigger Binding="{Binding IsTranscribing}" Value="True">
                                                    <Setter Property="Text" Value="Transcribing..."/>
                                                </DataTrigger>
                                                <DataTrigger Binding="{Binding IsModelLoading}" Value="True">
                                                    <Setter Property="Text" Value="Loading Model..."/>
                                                </DataTrigger>
                                                <DataTrigger Binding="{Binding IsModelLoaded}" Value="False">
                                                    <Setter Property="Text" Value="Model Not Loaded"/>
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </TextBlock.Style>
                                </TextBlock>
                                <TextBlock Text="{Binding ModelProfileDisplay}"
                                           FontSize="11"
                                           Foreground="{StaticResource Zinc500Brush}"
                                           Margin="0,3,0,0"/>
                            </StackPanel>

                            <!-- Hotkey Badge -->
                            <Border Grid.Column="2"
                                    Background="{StaticResource Zinc800Brush}"
                                    CornerRadius="6"
                                    Padding="10,5"
                                    VerticalAlignment="Center"
                                    ToolTip="Global hotkey - works from any application">
                                <TextBlock x:Name="HotkeyBadge"
                                           Text="Alt+Q"
                                           FontFamily="{StaticResource FontMono}"
                                           FontSize="11"
                                           Foreground="{StaticResource Zinc400Brush}"/>
                            </Border>
                        </Grid>
                    </Border>

                    <!-- Audio Level Bar -->
                    <Border Grid.Row="2"
                            Height="3"
                            CornerRadius="2"
                            Background="{StaticResource Zinc800Brush}"
                            Margin="0,14,0,0">
                        <Border CornerRadius="2"
                                HorizontalAlignment="Left"
                                Width="{Binding AudioLevel, Converter={StaticResource LevelToWidthConverter}}">
                            <Border.Style>
                                <Style TargetType="Border">
                                    <Setter Property="Background" Value="#32D583"/>
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding IsListening}" Value="True">
                                            <Setter Property="Background" Value="#FF6B6B"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </Border.Style>
                        </Border>
                    </Border>

                    <!-- Status Row -->
                    <Grid Grid.Row="3" Margin="0,16,0,0">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>

                        <TextBlock Grid.Column="0"
                                   Text="{Binding StatusText}"
                                   FontSize="12"
                                   Foreground="{StaticResource Zinc500Brush}"
                                   VerticalAlignment="Center"/>

                        <Button Grid.Column="1"
                                Style="{StaticResource GhostButton}"
                                Command="{Binding OpenSettingsCommand}"
                                ToolTip="Settings">
                            <Path Data="M12,8A4,4 0 0,1 16,12A4,4 0 0,1 12,16A4,4 0 0,1 8,12A4,4 0 0,1 12,8M12,10A2,2 0 0,0 10,12A2,2 0 0,0 12,14A2,2 0 0,0 14,12A2,2 0 0,0 12,10M10,22C9.75,22 9.54,21.82 9.5,21.58L9.13,18.93C8.5,18.68 7.96,18.34 7.44,17.94L4.95,18.95C4.73,19.03 4.46,18.95 4.34,18.73L2.34,15.27C2.21,15.05 2.27,14.78 2.46,14.63L4.57,12.97L4.5,12L4.57,11L2.46,9.37C2.27,9.22 2.21,8.95 2.34,8.73L4.34,5.27C4.46,5.05 4.73,4.96 4.95,5.05L7.44,6.05C7.96,5.66 8.5,5.32 9.13,5.07L9.5,2.42C9.54,2.18 9.75,2 10,2H14C14.25,2 14.46,2.18 14.5,2.42L14.87,5.07C15.5,5.32 16.04,5.66 16.56,6.05L19.05,5.05C19.27,4.96 19.54,5.05 19.66,5.27L21.66,8.73C21.79,8.95 21.73,9.22 21.54,9.37L19.43,11L19.5,12L19.43,13L21.54,14.63C21.73,14.78 21.79,15.05 21.66,15.27L19.66,18.73C19.54,18.95 19.27,19.04 19.05,18.95L16.56,17.95C16.04,18.34 15.5,18.68 14.87,18.93L14.5,21.58C14.46,21.82 14.25,22 14,22H10Z"
                                  Fill="{StaticResource Zinc500Brush}"
                                  Width="16" Height="16"
                                  Stretch="Uniform"/>
                        </Button>
                    </Grid>

                    <!-- Divider -->
                    <Border Grid.Row="4"
                            Height="1"
                            Background="{StaticResource Zinc800Brush}"
                            Margin="0,14,0,14"/>

                    <!-- Recent Transcriptions -->
                    <Grid Grid.Row="5">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>

                        <TextBlock Grid.Row="0"
                                   Text="RECENT"
                                   FontSize="10"
                                   FontWeight="SemiBold"
                                   Foreground="{StaticResource Zinc600Brush}"
                                   Margin="0,0,0,10"/>

                        <ScrollViewer Grid.Row="1"
                                      VerticalScrollBarVisibility="Auto"
                                      HorizontalScrollBarVisibility="Disabled">
                            <ItemsControl ItemsSource="{Binding History}">
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate>
                                        <Border Margin="0,0,0,6"
                                                Padding="12,10"
                                                CornerRadius="8"
                                                Cursor="Hand"
                                                MouseLeftButtonUp="HistoryItem_Click"
                                                ToolTip="Click to copy to clipboard">
                                            <Border.Style>
                                                <Style TargetType="Border">
                                                    <Setter Property="Background" Value="{StaticResource Zinc900Brush}"/>
                                                    <Style.Triggers>
                                                        <Trigger Property="IsMouseOver" Value="True">
                                                            <Setter Property="Background" Value="{StaticResource Zinc800Brush}"/>
                                                        </Trigger>
                                                    </Style.Triggers>
                                                </Style>
                                            </Border.Style>
                                            <Grid>
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="*"/>
                                                    <ColumnDefinition Width="Auto"/>
                                                </Grid.ColumnDefinitions>

                                                <TextBlock Grid.Column="0"
                                                           Text="{Binding Preview}"
                                                           FontSize="12"
                                                           Foreground="{StaticResource Zinc200Brush}"
                                                           TextTrimming="CharacterEllipsis"/>
                                                <TextBlock Grid.Column="1"
                                                           Text="{Binding TimeDisplay}"
                                                           FontSize="10"
                                                           Foreground="{StaticResource Zinc600Brush}"
                                                           Margin="10,0,0,0"
                                                           VerticalAlignment="Center"/>
                                            </Grid>
                                        </Border>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>
                        </ScrollViewer>

                        <!-- Empty State -->
                        <StackPanel Grid.Row="1"
                                    VerticalAlignment="Center"
                                    HorizontalAlignment="Center"
                                    Visibility="{Binding History.Count, Converter={StaticResource CountToVisibilityConverter}, ConverterParameter=inverse}">
                            <TextBlock Text="No transcriptions yet"
                                       FontSize="12"
                                       Foreground="{StaticResource Zinc600Brush}"
                                       HorizontalAlignment="Center"/>
                            <TextBlock Text="Press Alt+Q to start"
                                       FontSize="11"
                                       Foreground="{StaticResource Zinc700Brush}"
                                       HorizontalAlignment="Center"
                                       Margin="0,4,0,0"/>
                        </StackPanel>
                    </Grid>
                </Grid>
            </Grid>

            <!-- Toast Notification -->
            <controls:ToastNotification x:Name="Toast"
                                        VerticalAlignment="Bottom"
                                        HorizontalAlignment="Center"
                                        Margin="0,0,0,8"/>
        </Grid>
    </Border>
</Window>
